import{_ as s,c as a,a as e,o as l}from"./app-DyAfxzyW.js";const n={};function t(h,i){return l(),a("div",null,i[0]||(i[0]=[e(`<h1 id="处理项目git记录过大的问题" tabindex="-1"><a class="header-anchor" href="#处理项目git记录过大的问题"><span>处理项目Git记录过大的问题</span></a></h1><blockquote><p>之前在代码推送记录中提交记录中包含很多地图变动信息，每次变动包含5千左右的png变动信息导致git超过1G无法clone</p></blockquote><h2 id="git永久删除文件和历史记录" tabindex="-1"><a class="header-anchor" href="#git永久删除文件和历史记录"><span>Git永久删除文件和历史记录</span></a></h2><p>参考<a href="https://www.cnblogs.com/shines77/p/3460274.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/shines77/p/3460274.html</a></p><h3 id="使用filter-branch命令" tabindex="-1"><a class="header-anchor" href="#使用filter-branch命令"><span>使用filter-branch命令</span></a></h3><div class="language-git line-numbers-mode" data-highlighter="shiki" data-ext="git" data-title="git" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>$ git filter-branch --force --index-filter \\</span></span>
<span class="line"><span>&#39;git rm --cached --ignore-unmatch PATH-TO-YOUR-FILE-WITH-SENSITIVE-DATA&#39; \\</span></span>
<span class="line"><span>--prune-empty --tag-name-filter cat -- --all</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中, PATH-TO-YOUR-FILE-WITH-SENSITIVE-DATA 就是你要删除的文件的相对路径(相对于git仓库的根目录), 替换成你要删除的文件路径即可. 注意一点，这里的文件或文件夹，如果以 &#39;/&#39; 开头，则文件或文件夹会被认为是从 git 的安装目录开始。</p><p>如果你要删除的目标不是文件，而是文件夹，那么请在 git rm --cached 命令后面添加 -r 命令，表示递归的删除（子）文件夹和文件夹下的文件，类似于 rm -rf 命令。</p><p>例如：</p><div class="language-git line-numbers-mode" data-highlighter="shiki" data-ext="git" data-title="git" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>git filter-branch --force --index-filter &#39;git rm --cached -r --ignore-unmatch ./public/img/map/&#39; --prune-empty --tag-name-filter cat -- --all</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>注意： 输入命令前需要将所有分支代码拉取到本地</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fetch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --all</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 追踪所有分支</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> branch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;\\-&gt;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> remote</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> branch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --track</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --all</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果显示 xxxxx unchanged, 说明repo里没有找到该文件, 需检查路径和文件名是否正确.</p><h3 id="推送修改后的代码" tabindex="-1"><a class="header-anchor" href="#推送修改后的代码"><span>推送修改后的代码</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> origin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --all</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --tags</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="清理和回收空间" tabindex="-1"><a class="header-anchor" href="#清理和回收空间"><span>清理和回收空间</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .git/refs/original/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reflog</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> expire</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --expire=now</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --all</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --prune=now</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --aggressive</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --prune=now</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="优化git" tabindex="-1"><a class="header-anchor" href="#优化git"><span>优化Git</span></a></h2><h3 id="将地图打包成zip文件" tabindex="-1"><a class="header-anchor" href="#将地图打包成zip文件"><span>将地图打包成zip文件</span></a></h3><p>将地图图片打包成zip文件，使用每次构建时自动解压文件</p><ol><li><p>安装extract-zip-relative-path</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> i</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --save-dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> extract-zip-relative-path</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>每次启动或打包前先解压文件 修改package.json文件中的脚本部分</p><div class="language-diff line-numbers-mode" data-highlighter="shiki" data-ext="diff" data-title="diff" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&quot;serve&quot;: &quot;vue-cli-service serve&quot;,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&quot;build&quot;: &quot;vue-cli-service build&quot;,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+ &quot;preserve&quot;: &quot;extract-zip ./maptool/map.zip ./public/img&quot;,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+ &quot;prebuild&quot;: &quot;extract-zip ./maptool/map.zip ./public/img&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="编辑-gitignore" tabindex="-1"><a class="header-anchor" href="#编辑-gitignore"><span>编辑.gitignore</span></a></h3><div class="language-diff line-numbers-mode" data-highlighter="shiki" data-ext="diff" data-title="diff" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">node_modules</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/dist</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+ public/img/map/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,23)]))}const d=s(n,[["render",t],["__file","clearGit.html.vue"]]),p=JSON.parse('{"path":"/practice/clearGit.html","title":"处理项目Git记录过大的问题","lang":"zh-CN","frontmatter":{"date":"2022-05-16T00:00:00.000Z","category":"实践","tag":["git"]},"headers":[{"level":2,"title":"Git永久删除文件和历史记录","slug":"git永久删除文件和历史记录","link":"#git永久删除文件和历史记录","children":[{"level":3,"title":"使用filter-branch命令","slug":"使用filter-branch命令","link":"#使用filter-branch命令","children":[]},{"level":3,"title":"推送修改后的代码","slug":"推送修改后的代码","link":"#推送修改后的代码","children":[]},{"level":3,"title":"清理和回收空间","slug":"清理和回收空间","link":"#清理和回收空间","children":[]}]},{"level":2,"title":"优化Git","slug":"优化git","link":"#优化git","children":[{"level":3,"title":"将地图打包成zip文件","slug":"将地图打包成zip文件","link":"#将地图打包成zip文件","children":[]},{"level":3,"title":"编辑.gitignore","slug":"编辑-gitignore","link":"#编辑-gitignore","children":[]}]}],"git":{"createdTime":1737710761000,"updatedTime":1737710761000},"readingTime":{"minutes":1.71,"words":514},"filePathRelative":"practice/clearGit.md","localizedDate":"2022年5月16日"}');export{d as comp,p as data};
